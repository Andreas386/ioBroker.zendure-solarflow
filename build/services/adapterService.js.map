{
  "version": 3,
  "sources": ["../../src/services/adapterService.ts"],
  "sourcesContent": ["import { ZendureSolarflow } from \"../main\";\r\n\r\n/* eslint-disable @typescript-eslint/indent */\r\n\r\nexport const updateSolarFlowState = async (\r\n  adapter: ZendureSolarflow,\r\n  productKey: string,\r\n  deviceKey: string,\r\n  state: string,\r\n  val: number | string,\r\n): Promise<void> => {\r\n  adapter?.setStateAsync(`${productKey}.${deviceKey}.${state}`, val, true);\r\n};\r\n\r\nexport const checkVoltage = async (\r\n  adapter: ZendureSolarflow,\r\n  productKey: string,\r\n  deviceKey: string,\r\n  voltage: number,\r\n): Promise<void> => {\r\n  if (voltage < 46.1) {\r\n    if (adapter.config.useCalculation) {\r\n      // Set SOC to 0\r\n      adapter?.setStateAsync(\r\n        `${productKey}.${deviceKey}.calculations.soc`,\r\n        0,\r\n        true,\r\n      );\r\n\r\n      // Calculate new Wh Max Value\r\n      const energyWhState = await adapter.getStateAsync(\r\n        `${productKey}.${deviceKey}.calculations.energyWh`,\r\n      );\r\n      const energyWhMaxState = await adapter.getStateAsync(\r\n        `${productKey}.${deviceKey}.calculations.energyWhMax`,\r\n      );\r\n\r\n      const newMax = Number(energyWhMaxState?.val) - Number(energyWhState?.val);\r\n\r\n      // Set Max Energy to value minus current energy\r\n      adapter?.setStateAsync(\r\n        `${productKey}.${deviceKey}.calculations.energyWhMax`,\r\n        newMax,\r\n        true,\r\n      );\r\n\r\n      // Set Energy in Battery to 0\r\n      adapter?.setStateAsync(\r\n        `${productKey}.${deviceKey}.calculations.energyWh`,\r\n        0,\r\n        true,\r\n      );\r\n    }\r\n\r\n    if (adapter.config.useLowVoltageBlock) {\r\n      // Activate Low Voltage Block\r\n      adapter?.setStateAsync(\r\n        `${productKey}.${deviceKey}.control.lowVoltageBlock`,\r\n        true,\r\n        true,\r\n      );\r\n    }\r\n  } else if (voltage >= 48.0) {\r\n    if (adapter.config.useLowVoltageBlock) {\r\n      // Deactivate Low Voltage Block\r\n      adapter?.setStateAsync(\r\n        `${productKey}.${deviceKey}.control.lowVoltageBlock`,\r\n        false,\r\n        true,\r\n      );\r\n    }\r\n  }\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIO,MAAM,uBAAuB,OAClC,SACA,YACA,WACA,OACA,QACkB;AAClB,qCAAS,cAAc,GAAG,UAAU,IAAI,SAAS,IAAI,KAAK,IAAI,KAAK;AACrE;AAEO,MAAM,eAAe,OAC1B,SACA,YACA,WACA,YACkB;AAClB,MAAI,UAAU,MAAM;AAClB,QAAI,QAAQ,OAAO,gBAAgB;AAEjC,yCAAS;AAAA,QACP,GAAG,UAAU,IAAI,SAAS;AAAA,QAC1B;AAAA,QACA;AAAA;AAIF,YAAM,gBAAgB,MAAM,QAAQ;AAAA,QAClC,GAAG,UAAU,IAAI,SAAS;AAAA,MAC5B;AACA,YAAM,mBAAmB,MAAM,QAAQ;AAAA,QACrC,GAAG,UAAU,IAAI,SAAS;AAAA,MAC5B;AAEA,YAAM,SAAS,OAAO,qDAAkB,GAAG,IAAI,OAAO,+CAAe,GAAG;AAGxE,yCAAS;AAAA,QACP,GAAG,UAAU,IAAI,SAAS;AAAA,QAC1B;AAAA,QACA;AAAA;AAIF,yCAAS;AAAA,QACP,GAAG,UAAU,IAAI,SAAS;AAAA,QAC1B;AAAA,QACA;AAAA;AAAA,IAEJ;AAEA,QAAI,QAAQ,OAAO,oBAAoB;AAErC,yCAAS;AAAA,QACP,GAAG,UAAU,IAAI,SAAS;AAAA,QAC1B;AAAA,QACA;AAAA;AAAA,IAEJ;AAAA,EACF,WAAW,WAAW,IAAM;AAC1B,QAAI,QAAQ,OAAO,oBAAoB;AAErC,yCAAS;AAAA,QACP,GAAG,UAAU,IAAI,SAAS;AAAA,QAC1B;AAAA,QACA;AAAA;AAAA,IAEJ;AAAA,EACF;AACF;",
  "names": []
}
